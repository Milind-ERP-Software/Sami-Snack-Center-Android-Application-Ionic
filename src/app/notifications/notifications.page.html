<ion-header class="ion-no-border">
  <ion-toolbar style="--background: #0066CC; background: #0066CC; --border-width: 0;">
    <div class="navbar-container">
      <div class="navbar-left">
        <ion-button
          (click)="goBack()"
          fill="clear"
          size="small"
          style="--color: white;"
          class="h-8 w-8 p-0"
        >
          <ion-icon name="arrow-back" slot="icon-only" style="font-size: 16px;"></ion-icon>
        </ion-button>
        <ion-title class="navbar-title">
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <ion-icon name="notifications" style="font-size: 20px; color: white;"></ion-icon>
            <span style="color: white; font-weight: 600;">Notifications</span>
            <span *ngIf="unreadCount > 0" class="badge-count">{{ unreadCount }}</span>
          </div>
        </ion-title>
      </div>
      <div class="navbar-right">
        <ion-button
          (click)="markAllAsRead()"
          fill="clear"
          size="small"
          style="--color: white;"
          class="h-8 w-8 p-0"
          [disabled]="unreadCount === 0"
        >
          <ion-icon name="checkmark-done" slot="icon-only" style="font-size: 18px;"></ion-icon>
        </ion-button>
      </div>
    </div>
  </ion-toolbar>
</ion-header>

  <ion-content class="ion-padding" [fullscreen]="true" [style.--background]="isDarkMode ? '#111827' : '#f5f5f5'" [style.background]="isDarkMode ? '#111827' : '#f5f5f5'" style="--padding-start: 0.375rem; --padding-end: 0.375rem; --padding-top: 0.375rem; --padding-bottom: 0.375rem;">
  <ion-refresher slot="fixed" (ionRefresh)="handleRefresh($event)">
    <ion-refresher-content></ion-refresher-content>
  </ion-refresher>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="skeleton-notification" *ngFor="let i of [1,2,3,4,5]">
      <div class="skeleton-icon"></div>
      <div class="skeleton-content">
        <div class="skeleton-title"></div>
        <div class="skeleton-message"></div>
        <div class="skeleton-time"></div>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredNotifications.length === 0" class="empty-state">
        <ion-icon name="notifications-outline" style="font-size: 40px; color: #9ca3af;"></ion-icon>
    <h3>No Notifications Yet</h3>
    <p>You're all caught up! Check back later for new updates.</p>
  </div>

  <!-- Notifications List -->
  <div *ngIf="!isLoading && filteredNotifications.length > 0" class="notifications-container">
    <!-- Action Buttons -->
    <div class="action-buttons" *ngIf="filteredNotifications.length > 0">
      <ion-button
        (click)="deleteReadNotifications()"
        fill="outline"
        size="small"
        [style.--border-color]="isDarkMode ? '#4b5563' : '#d1d5db'"
        [style.--color]="isDarkMode ? '#d1d5db' : '#6b7280'"
        class="action-btn clear-read-btn"
      >
        <ion-icon name="trash" slot="start" style="font-size: 11px;"></ion-icon>
        Clear Read
      </ion-button>
      <ion-button
        (click)="deleteAllNotifications()"
        fill="solid"
        size="small"
        style="--background: #ef4444; --color: white; --border-color: #ef4444;"
        class="action-btn clear-all-btn"
      >
        <ion-icon name="trash" slot="start" style="font-size: 11px;"></ion-icon>
        Clear All
      </ion-button>
    </div>

    <!-- Notifications -->
    <div class="notifications-list">
      <div
        *ngFor="let notification of filteredNotifications; trackBy: trackByNotificationId"
        class="notification-item"
        [class.unread]="!notification.isRead"
        [class.alert]="notification.type === 'alert'"
        [class.insight]="notification.type === 'insight'"
        [class.activity]="notification.type === 'activity'"
        [class.reminder]="notification.type === 'reminder'"
        (click)="handleNotificationClick(notification)"
      >
        <div class="notification-icon" [style.background]="getIconBackground(notification.color)">
          <ion-icon [name]="notification.icon" [style.color]="getIconColor(notification.color)"></ion-icon>
        </div>
        <div class="notification-content">
          <div class="notification-header">
            <h4 class="notification-title">{{ notification.title }}</h4>
            <ion-button
              (click)="deleteNotification(notification, $event)"
              fill="clear"
              size="small"
              class="delete-btn"
            >
              <ion-icon name="close-circle" style="font-size: 14px; color: #9ca3af;"></ion-icon>
            </ion-button>
          </div>
          <p class="notification-message">{{ notification.message }}</p>
          <div class="notification-footer">
            <span class="notification-time">{{ formatTimestamp(notification.timestamp) }}</span>
            <span class="notification-category">{{ notification.category }}</span>
            <ion-button
              *ngIf="notification.actionRoute && notification.actionLabel"
              (click)="handleNotificationClick(notification); $event.stopPropagation()"
              fill="clear"
              size="small"
              class="action-btn-small"
            >
              {{ notification.actionLabel }}
              <ion-icon name="arrow-forward" slot="end" style="font-size: 10px;"></ion-icon>
            </ion-button>
          </div>
        </div>
        <div class="unread-indicator" *ngIf="!notification.isRead"></div>
      </div>
    </div>
  </div>
</ion-content>

